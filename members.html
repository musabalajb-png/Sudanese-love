<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†ØµÙŠØ¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ | Ù…Ù†ØµØ© Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¢Ù…Ù†Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f0f4f8; overflow-x: hidden; margin: 0; }
        
        /* 1. ØªØ£Ø«ÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© */
        .bg-canvas {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(45deg, #fff5f5, #f0fdf4, #f5f3ff, #fff9db);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            z-index: -2;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* 2. Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø±Ø© */
        .heart-bg { position: fixed; color: rgba(255, 182, 193, 0.4); font-size: 20px; pointer-events: none; z-index: -1; animation: fall linear infinite; }
        @keyframes fall { from { transform: translateY(-10vh) rotate(0deg); opacity: 1; } to { transform: translateY(110vh) rotate(360deg); opacity: 0; } }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙƒØ±ÙˆØª */
        .member-card { border-radius: 2.5rem; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(10px); transition: 0.4s; position: relative; border: 1.5px solid rgba(255, 255, 255, 0.5); overflow: hidden; display: flex; flex-direction: column; cursor: pointer; }
        .member-card:hover { transform: scale(1.05) translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .gold-member { border: 2.3px solid #fbbf24 !important; box-shadow: 0 10px 25px rgba(251, 191, 36, 0.2); }
        .img-box { width: 100%; padding-top: 110%; position: relative; overflow: hidden; background: #f8fafc; }
        .img-box img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; transition: 0.6s ease; }
        .blur-effect { filter: blur(30px); transform: scale(1.1); }
        
        .gift-anim { position: absolute; font-size: 2.5rem; animation: floatUp 1.5s ease-out forwards; z-index: 50; pointer-events: none; }
        @keyframes floatUp { 0% { bottom: 20%; opacity: 1; } 100% { bottom: 85%; opacity: 0; transform: scale(2.5) rotate(15deg); } }
        
        .music-btn {
            position: fixed; bottom: 25px; left: 25px; width: 50px; height: 50px;
            background: white; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1); z-index: 1000; cursor: pointer; color: #16a34a;
        }
        .music-playing { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(22, 163, 74, 0); } 100% { box-shadow: 0 0 0 0 rgba(22, 163, 74, 0); } }

        .vip-tag { position: absolute; top: 12px; right: 12px; background: linear-gradient(135deg, #fbbf24, #d97706); color: white; padding: 3px 12px; border-radius: 20px; font-size: 10px; font-weight: bold; z-index: 10; }
    </style>
</head>
<body class="pb-10">

    <div class="bg-canvas"></div>
    <div id="heartsContainer"></div>

    <div class="music-btn" id="musicToggle" onclick="toggleMusic()">
        <i class="fas fa-music"></i>
        <audio id="bgAudio" loop>
            <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        </audio>
    </div>

    <div id="giftBanner" class="bg-gradient-to-r from-slate-900 to-slate-800 text-white p-2 text-[10px] text-center font-bold">
        âœ¨ ÙŠØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©.. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ù†ØµÙŠØ¨Ùƒ Ø§Ù„ÙŠÙˆÙ…!
    </div>

    <nav class="bg-white/70 backdrop-blur-md shadow-sm p-4 sticky top-0 z-50 border-b border-white/20">
        <div class="container mx-auto flex justify-between items-center px-4">
            <span onclick="window.location.href='index.html'" class="cursor-pointer font-bold text-green-700 text-xl flex items-center gap-2">ğŸ’ Ù†ØµÙŠØ¨</span>
            <div class="flex gap-2">
                <div class="bg-red-50 text-red-600 px-4 py-1.5 rounded-full text-[11px] font-bold border border-red-100 flex items-center gap-1">
                    <span>ğŸŒ¹</span> <span id="roseCount">0</span>
                </div>
                <div class="bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full text-[11px] font-bold border border-blue-100 flex items-center gap-1">
                    <span>ğŸ’Œ</span> <span id="msgCount">0</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 mt-2">
        <div class="bg-white/50 backdrop-blur-xl rounded-[1.5rem] p-3 shadow-sm border border-white/50 flex items-center gap-3 mb-6">
            <i class="fas fa-search text-slate-400 ml-2"></i>
            <input type="text" id="searchInput" onkeyup="filterMembers()" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©..." class="w-full outline-none text-sm text-slate-700 bg-transparent font-bold">
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mt-4" id="membersGrid">
            </div>
    </div>

    <div id="chatBox" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl relative border-t-8 border-green-600">
            <div id="chatAvatar" class="w-20 h-20 rounded-full mx-auto mb-4 border-4 border-green-50 overflow-hidden shadow-lg"></div>
            <h3 id="targetName" class="font-bold text-center text-xl mb-4 text-slate-800"></h3>
            <textarea id="msgInput" placeholder="Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ø¹Ø¬Ø§Ø¨ Ù…Ø­ØªØ±Ù…Ø©..." class="w-full h-28 p-5 bg-slate-50 rounded-2xl border-none outline-none text-sm"></textarea>
            <div class="grid grid-cols-2 gap-4 mt-6">
                <button onclick="sendLiveMessage()" class="bg-green-600 text-white py-3 rounded-2xl font-bold">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
                <button onclick="closeChat()" class="bg-slate-100 text-slate-500 py-3 rounded-2xl font-bold">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        if (localStorage.getItem('naseeb_logged') !== 'true') { window.location.href = 'index.html'; }

        // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ø´ÙŠØª (CSV)
        const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHsoqVm7cDIUgGw6u5n0yO8U19lyqKLrrskUn6Q7At1Q04hrXdC7HxojsDnxj7Frld2__eJOBBMEX6/pub?output=csv";

        // Ù‚Ù„ÙˆØ¨ Ø¹Ø§Ø¦Ù…Ø©
        function createHeart() {
            const container = document.getElementById('heartsContainer');
            const heart = document.createElement('div');
            heart.className = 'heart-bg';
            heart.innerHTML = ['â¤ï¸', 'ğŸ’–', 'âœ¨', 'ğŸŒ¸'][Math.floor(Math.random()*4)];
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.animationDuration = (Math.random() * 5 + 5) + 's';
            container.appendChild(heart);
            setTimeout(() => heart.remove(), 10000);
        }
        setInterval(createHeart, 1500);

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
        let isPlaying = false;
        function toggleMusic() {
            const audio = document.getElementById('bgAudio');
            const btn = document.getElementById('musicToggle');
            if(isPlaying) { audio.pause(); btn.classList.remove('music-playing'); btn.innerHTML = '<i class="fas fa-music"></i>'; }
            else { audio.play(); btn.classList.add('music-playing'); btn.innerHTML = '<i class="fas fa-pause"></i>'; }
            isPlaying = !isPlaying;
        }

        async function load() {
            // Ø§Ù„Ø³ÙŠØ³ØªÙ… Ø§Ù„ÙŠÙˆÙ…ÙŠ
            const today = new Date().toDateString();
            if (localStorage.getItem('lastVisitDate') !== today) {
                localStorage.setItem('roses', '10'); 
                localStorage.setItem('msgs', '3'); 
                localStorage.setItem('lastVisitDate', today);
            }

            try {
                const res = await fetch(sheetURL);
                const data = await res.text();
                // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„ÙØ§Ø±ØºØ©
                const rows = data.split('\n').map(r => r.trim()).filter(r => r !== "").slice(1);
                const grid = document.getElementById('membersGrid');
                grid.innerHTML = ""; 

                const userPlan = localStorage.getItem('userPlan') || 'Ø¹Ø§Ø¯ÙŠØ©';
                const isPaid = /Ø§Ù„Ø³ØªØ±|Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(userPlan);

                rows.forEach((row, index) => {
                    const cols = row.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
                    if(cols.length < 5) return;

                    const member = {
                        name: cols[0],
                        plan: cols[2] || 'Ø¹Ø§Ø¯ÙŠØ©',
                        city: cols[3] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        img: cols[6] || `https://ui-avatars.com/api/?name=${cols[0]}&background=random`,
                        age: cols[1], status: cols[4] // Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
                    };

                    const dataStr = encodeURIComponent(JSON.stringify(member));

                    grid.innerHTML += `
                        <div class="member-card ${member.plan.includes('Ø°Ù‡Ø¨ÙŠØ©') ? 'gold-member' : ''}" id="card-${index}" data-name="${member.name}" data-city="${member.city}">
                            ${member.plan.includes('Ø°Ù‡Ø¨ÙŠØ©') || member.plan.includes('Ù…Ø§Ø³ÙŠØ©') ? '<span class="vip-tag"><i class="fas fa-crown"></i> VIP</span>' : ''}
                            <div class="img-box" onclick="viewProfile('${dataStr}')">
                                <img src="${member.img}" class="${isPaid ? '' : 'blur-effect'}" onerror="this.src='https://ui-avatars.com/api/?name=${member.name}'">
                            </div>
                            <div class="p-4 text-center">
                                <h4 class="font-bold text-[11px] text-slate-700 truncate">${member.name}</h4>
                                <p class="text-[9px] text-slate-400 mb-3"><i class="fas fa-map-marker-alt"></i> ${member.city}</p>
                                <div class="flex gap-2 justify-center">
                                    <button onclick="event.stopPropagation(); dropGift('card-${index}', 'ğŸŒ¹')" class="bg-red-50 text-red-600 p-2.5 rounded-2xl text-sm hover:bg-red-100 transition">ğŸŒ¹</button>
                                    <button onclick="event.stopPropagation(); openChat('${member.name}', '${member.img}')" class="bg-green-600 text-white px-4 py-2 rounded-2xl text-[10px] font-bold flex-1 hover:bg-green-700 transition">ğŸ’Œ Ø¥Ø¹Ø¬Ø§Ø¨</button>
                                </div>
                            </div>
                        </div>`;
                });
                updateCounters();
            } catch (e) {
                console.error("Load Error:", e);
                alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª.");
            }
        }

        function updateCounters() {
            document.getElementById('roseCount').innerText = localStorage.getItem('roses') || 0;
            document.getElementById('msgCount').innerText = localStorage.getItem('msgs') || 0;
        }

        function viewProfile(dataStr) {
            sessionStorage.setItem('currentProfile', decodeURIComponent(dataStr));
            window.location.href = 'profile.html';
        }

        function filterMembers() {
            let val = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.member-card').forEach(card => {
                let name = card.getAttribute('data-name').toLowerCase();
                let city = card.getAttribute('data-city').toLowerCase();
                card.style.display = (name.includes(val) || city.includes(val)) ? "" : "none";
            });
        }

        function dropGift(cardId, emoji) {
            let r = parseInt(localStorage.getItem('roses'));
            if(r <= 0) return alert("Ø§Ù†ØªÙ‡Ù‰ Ø±ØµÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ğŸŒ¹");
            
            localStorage.setItem('roses', r - 1);
            updateCounters();
            
            const card = document.getElementById(cardId);
            const gift = document.createElement('div');
            gift.className = 'gift-anim'; 
            gift.innerHTML = emoji; 
            gift.style.left = "45%";
            card.appendChild(gift);
            setTimeout(() => gift.remove(), 1500);
        }

        function openChat(name, img) {
            document.getElementById('targetName').innerText = "ØªÙˆØ§ØµÙ„ Ù…Ø¹ " + name;
            document.getElementById('chatAvatar').innerHTML = `<img src="${img}" class="w-full h-full object-cover" onerror="this.src='https://ui-avatars.com/api/?name=${name}'">`;
            document.getElementById('chatBox').classList.remove('hidden');
        }

        function closeChat() { document.getElementById('chatBox').classList.add('hidden'); }

        function sendLiveMessage() {
            let m = parseInt(localStorage.getItem('msgs'));
            if(m <= 0) return alert("Ø§Ù†ØªÙ‡Ù‰ Ø±ØµÙŠØ¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ğŸ’Œ");
            
            localStorage.setItem('msgs', m - 1);
            updateCounters();
            alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ… Ø³ÙŠØªÙ… Ø¥Ø®Ø·Ø§Ø± Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø¢Ø®Ø±.");
            closeChat();
        }

        window.onload = load;
    </script>
</body>
</html>
