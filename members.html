<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†ØµÙŠØ¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ | Ù…Ù†ØµØ© Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø°ÙƒÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary-green: #15803d; --accent-gold: #fbbf24; }
        body { font-family: 'Cairo', sans-serif; background: #f8fafc; overflow-x: hidden; user-select: none; }
        .bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #f0fdf4 0%, #ffffff 100%); z-index: -2; }
        
        /* Member Card Styling */
        .member-card { border-radius: 2rem; background: white; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; border: 1px solid #f1f5f9; overflow: hidden; display: flex; flex-direction: column; height: 100%; }
        .member-card:hover { transform: translateY(-10px); box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.08); }
        .img-box { width: 100%; padding-top: 120%; position: relative; overflow: hidden; background: #e2e8f0; }
        .img-box img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; transition: 0.8s; }
        .blur-effect { filter: blur(25px); transform: scale(1.1); }
        .premium-badge { position: absolute; top: 12px; right: 12px; background: linear-gradient(45deg, #fbbf24, #f59e0b); color: white; padding: 4px 12px; border-radius: 50px; font-size: 10px; font-weight: 900; z-index: 10; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .blur-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.2); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 5; backdrop-filter: blur(4px); }
        .unlock-btn { background: white; color: var(--primary-green); padding: 8px 16px; border-radius: 50px; font-size: 11px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .unlock-btn:hover { background: var(--primary-green); color: white; }

        /* Animation & UI */
        .online-dot { position: absolute; bottom: 12px; left: 12px; width: 12px; height: 12px; background: #22c55e; border-radius: 50%; border: 2px solid white; z-index: 10; }
        .dot-pulse { animation: dot-pulse 2s infinite; }
        @keyframes dot-pulse { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); } 70% { box-shadow: 0 0 0 8px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
        .filter-chip { @apply px-5 py-2 rounded-full border border-slate-200 text-sm font-bold text-slate-500 transition-all cursor-pointer whitespace-nowrap bg-white; }
        .filter-chip.active { @apply bg-green-700 border-green-700 text-white shadow-lg shadow-green-200; }
        .action-btn { @apply flex-1 py-2 rounded-xl text-[11px] font-black transition-all active:scale-95 flex items-center justify-center gap-1 shadow-sm; }
        
        #notifPanel { display: none; position: fixed; top: 80px; left: 20px; right: 20px; max-width: 400px; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); z-index: 2000; padding: 20px; border: 1px solid #eee; }
        #chatWindow { display: none; position: fixed; bottom: 0; left: 0; right: 0; top: 0; background: white; z-index: 3000; flex-direction: column; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-24">

    <div id="loadingMembers" class="fixed inset-0 bg-white z-[5000] flex flex-col items-center justify-center">
        <div class="relative">
            <div class="w-20 h-20 border-4 border-green-100 rounded-full"></div>
            <div class="w-20 h-20 border-4 border-green-700 border-t-transparent rounded-full animate-spin absolute top-0"></div>
        </div>
        <p class="mt-6 font-bold text-green-800 animate-pulse text-lg">Ø¬Ø§Ø±ÙŠ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø³ØªØ±...</p>
    </div>

    <div class="bg-canvas"></div>

    <nav class="bg-white/80 backdrop-blur-xl shadow-sm p-4 sticky top-0 z-50 border-b border-slate-100">
        <div class="container mx-auto flex justify-between items-center px-2">
            <div class="flex items-center gap-3 cursor-pointer" onclick="location.href='index.html'">
                <div class="w-10 h-10 bg-green-700 rounded-2xl flex items-center justify-center text-white shadow-lg"><i class="fas fa-ring text-lg"></i></div>
                <span class="font-black text-green-800 text-xl tracking-tighter">Ù†ØµÙŠØ¨</span>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleNotif()" class="relative w-10 h-10 bg-slate-100 rounded-full text-slate-600 transition-colors hover:bg-slate-200">
                    <i class="fas fa-bell"></i>
                    <span id="notifBadge" class="absolute -top-1 -left-1 bg-red-500 text-white text-[9px] px-1.5 py-0.5 rounded-full hidden border-2 border-white">0</span>
                </button>
                <button onclick="logout()" class="w-10 h-10 bg-red-50 text-red-500 rounded-2xl flex items-center justify-center hover:bg-red-500 hover:text-white transition-all"><i class="fas fa-power-off"></i></button>
            </div>
        </div>
    </nav>

    <div id="notifPanel">
        <div class="flex justify-between items-center mb-4">
            <h4 class="font-black text-slate-800">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h4>
            <button onclick="toggleNotif()" class="text-slate-400"><i class="fas fa-times"></i></button>
        </div>
        <div id="notifList" class="max-h-60 overflow-y-auto space-y-2 no-scrollbar"></div>
    </div>

    <div id="chatWindow">
        <div class="bg-green-800 p-4 text-white flex justify-between items-center shadow-lg">
            <div class="flex items-center gap-3">
                <button onclick="closeChat()" class="p-2 hover:bg-green-700 rounded-full transition-colors"><i class="fas fa-arrow-right"></i></button>
                <div>
                    <span id="chatPartnerName" class="font-bold block text-sm"></span>
                    <span class="text-[9px] text-green-200"><i class="fas fa-circle text-[6px] text-green-400 ml-1"></i>Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</span>
                </div>
            </div>
            <span id="chatCounter" class="text-[10px] bg-green-900/50 border border-green-600 px-3 py-1 rounded-full font-bold"></span>
        </div>
        <div id="chatMessages" class="flex-1 p-4 bg-slate-50 overflow-y-auto flex flex-col gap-3 no-scrollbar"></div>
        <div class="p-4 bg-white border-t flex gap-2 items-center">
            <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø¬Ø§Ø¯Ø©..." class="flex-1 bg-slate-100 rounded-full px-5 py-3 text-sm outline-none focus:ring-2 focus:ring-green-500 transition-all">
            <button onclick="sendMessage()" class="w-12 h-12 bg-green-700 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-green-800 active:scale-90 transition-all"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div class="container mx-auto p-5">
        <div class="mb-8">
            <div class="bg-white rounded-[2rem] p-3 shadow-sm flex items-center gap-3 border border-slate-100 mb-5 focus-within:ring-2 focus-within:ring-green-500 transition-all">
                <i class="fas fa-search text-slate-300 mr-2"></i>
                <input type="text" id="searchInput" onkeyup="filterMembers()" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©ØŒ Ø£Ùˆ Ø§Ù„Ù…Ù‡Ù†Ø©..." class="w-full bg-transparent outline-none font-bold text-slate-700 text-sm">
            </div>
            <div class="flex gap-2 overflow-x-auto pb-2 no-scrollbar" id="filterContainer">
                <div class="filter-chip active" onclick="setFilter('all', this)">Ø§Ù„ÙƒÙ„</div>
                <div class="filter-chip" onclick="setFilter('Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†', this)">Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</div>
                <div class="filter-chip" onclick="setFilter('Ø®Ø§Ø±Ø¬ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†', this)">Ø§Ù„Ù…ØºØªØ±Ø¨ÙŠÙ†</div>
            </div>
        </div>

        <div id="suggestionSection" class="hidden mb-12">
            <h3 class="font-black text-slate-800 text-lg mb-4 flex items-center gap-2">
                <span class="w-2 h-2 bg-amber-500 rounded-full animate-ping"></span> Ù…Ù‚ØªØ±Ø­Ø§Øª ØªÙ†Ø§Ø³Ø¨ Ù…Ø¯ÙŠÙ†ØªÙƒ
            </h3>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="suggestGrid"></div>
        </div>

        <div class="flex items-center justify-between mb-6">
            <h3 class="font-black text-slate-800 text-lg">Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ Ø§Ù„Ø¬Ø§Ø¯ÙŠÙ†</h3>
            <span class="text-[10px] font-bold text-slate-500 px-3 py-1 bg-white rounded-lg border shadow-sm" id="totalCountDisplay">0 Ù…Ø´ØªØ±Ùƒ</span>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="membersGrid"></div>
    </div>

    <div id="appToast" class="fixed top-24 left-1/2 -translate-x-1/2 z-[6000] bg-slate-900 text-white px-6 py-3 rounded-full text-xs font-bold shadow-2xl hidden animate-bounce"></div>

    <script>
        const CONFIG = {
            sheetURL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHsoqVm7cDIUgGw6u5n0yO8U19lyqKLrrskUn6Q7At1Q04hrXdC7HxojsDnxj7Frld2__eJOBBMEX6/pub?output=csv",
            planLimits: {
                'Ø¹Ø§Ø¯ÙŠØ©': { likes: 10, gifts: 10, chats: 3 },
                'Ø§Ù„Ø³ØªØ±': { likes: 20, gifts: 20, chats: 20 },
                'Ø°Ù‡Ø¨ÙŠØ©': { likes: 50, gifts: 50, chats: 100 },
                'Ù…Ø§Ø³ÙŠØ©': { likes: 9999, gifts: 9999, chats: 9999 },
                'VIP': { likes: 9999, gifts: 9999, chats: 9999 }
            }
        };

        let allMembers = [];
        let notifications = [];

        // --- Ø§Ù„Ø£Ù…Ù† ÙˆØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        function getSecureStats() {
            const today = new Date().toDateString();
            let data = JSON.parse(localStorage.getItem('naseeb_secure_data')) || {};
            
            if (data.date !== today) {
                data = { date: today, likes: 0, gifts: 0, chats: 0 };
                localStorage.setItem('naseeb_secure_data', JSON.stringify(data));
            }
            return data;
        }

        function checkActionLimit(type) {
            const stats = getSecureStats();
            const plan = localStorage.getItem('userPlan') || 'Ø¹Ø§Ø¯ÙŠØ©';
            const limits = CONFIG.planLimits[plan] || CONFIG.planLimits['Ø¹Ø§Ø¯ÙŠØ©'];

            if (stats[type] >= limits[type]) {
                alert(`âš ï¸ ØªÙ†Ø¨ÙŠÙ‡: Ø§Ø³ØªÙ†ÙØ¯Øª Ø­Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† (${type === 'likes' ? 'Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª' : type === 'gifts' ? 'Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§' : 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„'}).\n\nØ¨Ø§Ù‚Ø© (${plan}) ØªÙ…Ù†Ø­Ùƒ ${limits[type]} Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹.\nÙ‚Ù… Ø¨Ø§Ù„ØªØ±Ù‚ÙŠØ© Ù„ÙØªØ­ ØªÙˆØ§ØµÙ„ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯.`);
                if(type === 'chats') location.href = '#pricing';
                return false;
            }
            return true;
        }

        function incrementStat(type) {
            const stats = getSecureStats();
            stats[type]++;
            localStorage.setItem('naseeb_secure_data', JSON.stringify(stats));
            updateVisualCounters();
        }

        function updateVisualCounters() {
            const stats = getSecureStats();
            const plan = localStorage.getItem('userPlan') || 'Ø¹Ø§Ø¯ÙŠØ©';
            const limits = CONFIG.planLimits[plan] || CONFIG.planLimits['Ø¹Ø§Ø¯ÙŠØ©'];
            const counterEl = document.getElementById('chatCounter');
            
            if (limits.chats > 1000) {
                counterEl.innerHTML = `<i class="fas fa-infinity ml-1"></i> Ø¨Ø§Ù‚Ø© Ù…ÙØªÙˆØ­Ø©`;
            } else {
                const remaining = limits.chats - stats.chats;
                counterEl.innerText = `Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ùƒ: ${remaining} Ø±Ø³Ø§Ù„Ø©`;
            }
        }

        // --- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        async function load() {
            try {
                const res = await fetch(`${CONFIG.sheetURL}?cb=${Date.now()}`);
                const data = await res.text();
                const rows = data.split('\n').slice(1);
                
                const grid = document.getElementById('membersGrid');
                const suggestGrid = document.getElementById('suggestGrid');
                const suggestSection = document.getElementById('suggestionSection');
                
                const myPlan = localStorage.getItem('userPlan') || 'Ø¹Ø§Ø¯ÙŠØ©';
                const isPaid = /Ø§Ù„Ø³ØªØ±|Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©|VIP/i.test(myPlan);
                const myCity = localStorage.getItem('userCity') || '';

                allMembers = [];
                grid.innerHTML = ""; suggestGrid.innerHTML = "";

                rows.forEach((row, index) => {
                    const cols = row.split(',').map(c => c.trim().replace(/^"|"$/g, ''));
                    if(!cols[0] || cols[0].length < 2) return;

                    const m = { 
                        name: cols[0], 
                        city: cols[3] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯', 
                        plan: cols[2] || 'Ø¹Ø§Ø¯ÙŠØ©', 
                        img: cols[6], 
                        job: cols[4] || 'Ø¹Ø¶Ùˆ' 
                    };
                    allMembers.push(m);
                    
                    const cardHTML = createCard(m, index, isPaid);
                    
                    // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª (Ù†ÙØ³ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©)
                    if (myCity && m.city.includes(myCity) && m.name !== localStorage.getItem('userName')) {
                        suggestGrid.innerHTML += cardHTML;
                        suggestSection.classList.remove('hidden');
                    } else {
                        grid.innerHTML += cardHTML;
                    }
                });

                document.getElementById('totalCountDisplay').innerText = `${allMembers.length} Ù…Ø´ØªØ±Ùƒ Ø¬Ø§Ø¯`;
                document.getElementById('loadingMembers').style.display = 'none';
                updateVisualCounters();
            } catch (e) {
                console.error("Fetch Error:", e);
                showToast("âš ï¸ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„.");
            }
        }

        function createCard(m, i, isPaid) {
            const isPremium = /Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©|VIP/i.test(m.plan);
            return `
                <div class="member-card member-item" data-tags="${m.name} ${m.city} ${m.job}">
                    <div class="img-box">
                        ${isPremium ? '<div class="premium-badge"><i class="fas fa-crown text-[8px] ml-1"></i>Ù…Ù…ÙŠØ²</div>' : ''}
                        <div class="online-dot dot-pulse"></div>
                        <img src="${m.img || 'https://ui-avatars.com/api/?background=f0fdf4&color=15803d&name='+m.name}" class="${!isPaid ? 'blur-effect' : ''}" loading="lazy">
                        ${!isPaid ? `<div class="blur-overlay"><button class="unlock-btn" onclick="location.href='index.html#pricing'">ÙØªØ­ Ø§Ù„ØµÙˆØ±Ø© ğŸ”“</button></div>` : ''}
                    </div>
                    <div class="p-3 flex-1 flex flex-col">
                        <h4 class="font-black text-[12px] text-slate-800 truncate mb-0.5">${m.name} <i class="fas fa-check-circle text-blue-500 text-[9px]"></i></h4>
                        <p class="text-[9px] text-slate-400 mb-3"><i class="fas fa-map-marker-alt ml-1 text-red-400"></i>${m.city}</p>
                        <div class="mt-auto flex gap-1">
                            <button onclick="actionLike('${m.name}')" class="action-btn bg-rose-50 text-rose-500 hover:bg-rose-500 hover:text-white" title="Ø¥Ø¹Ø¬Ø§Ø¨"><i class="fas fa-heart"></i></button>
                            <button onclick="actionGift('${m.name}')" class="action-btn bg-amber-50 text-amber-500 hover:bg-amber-500 hover:text-white" title="Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø¯ÙŠØ©"><i class="fas fa-gift"></i></button>
                            <button onclick="actionChat('${m.name}')" class="action-btn bg-green-50 text-green-700 hover:bg-green-700 hover:text-white" title="Ø¨Ø¯Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø©"><i class="fas fa-comment-dots"></i></button>
                        </div>
                    </div>
                </div>`;
        }

        // --- Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª ---
        function actionLike(name) {
            if(!checkActionLimit('likes')) return;
            incrementStat('likes');
            showToast(`â¤ï¸ Ø£Ø±Ø³Ù„Øª Ø¥Ø¹Ø¬Ø§Ø¨Ø§Ù‹ Ù„Ù€ ${name}`);
        }

        function actionGift(name) {
            if(!checkActionLimit('gifts')) return;
            if(confirm(`Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø¯ÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù€ ${name} Ù„ÙØª Ø§Ù†ØªØ¨Ø§Ù‡ØŸ`)) {
                incrementStat('gifts');
                showToast(`ğŸ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­`);
            }
        }

        function actionChat(name) {
            if(!checkActionLimit('chats')) return;
            showToast(`ğŸ“© Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ ${name}`);
            setTimeout(() => addNotification(name, 'Ø·Ù„Ø¨ ØªÙˆØ§ØµÙ„ Ø¬Ø¯ÙŠØ¯'), 1000);
        }

        function addNotification(sender, type) {
            const id = Date.now();
            notifications.unshift({ id, sender, type });
            updateNotifBadge();
            renderNotifs();
        }

        function updateNotifBadge() {
            const badge = document.getElementById('notifBadge');
            badge.innerText = notifications.length;
            notifications.length > 0 ? badge.classList.remove('hidden') : badge.classList.add('hidden');
        }

        function renderNotifs() {
            const list = document.getElementById('notifList');
            if(notifications.length === 0) {
                list.innerHTML = '<div class="text-center py-5"><i class="fas fa-bell-slash text-slate-200 text-3xl mb-2"></i><p class="text-slate-400 text-[10px]">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</p></div>';
                return;
            }
            list.innerHTML = notifications.map(n => `
                <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <div class="flex flex-col">
                        <span class="text-[11px] font-black text-slate-800">${n.sender}</span>
                        <span class="text-[9px] text-slate-500">${n.type}</span>
                    </div>
                    <div class="flex gap-1">
                        <button onclick="acceptChat('${n.sender}', ${n.id})" class="bg-green-600 text-white text-[9px] px-3 py-1.5 rounded-lg font-bold">Ù‚Ø¨ÙˆÙ„</button>
                        <button onclick="dismissNotif(${n.id})" class="text-slate-400 text-[9px] p-1.5 hover:text-red-500"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        function acceptChat(name, id) {
            dismissNotif(id);
            toggleNotif();
            document.getElementById('chatPartnerName').innerText = name;
            document.getElementById('chatWindow').style.display = 'flex';
            document.getElementById('chatMessages').innerHTML = `
                <div class="bg-amber-50 border border-amber-100 p-3 rounded-2xl text-[10px] text-amber-800 text-center leading-relaxed">
                    ğŸ”” ØªØ°ÙƒØ±: Ù‡Ø°Ø§ Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¨ØºØ±Ø¶ Ø§Ù„Ø³ØªØ± ÙˆØ§Ù„Ø²ÙˆØ§Ø¬ Ø§Ù„Ø­Ù„Ø§Ù„. Ø§Ù„ØªØ²Ù… Ø¨Ø§Ù„Ø£Ø¯Ø¨ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠ ÙÙŠ Ø­Ø¯ÙŠØ«Ùƒ.
                </div>
            `;
        }

        function sendMessage() {
            const input = document.getElementById('msgInput');
            const chatBox = document.getElementById('chatMessages');
            
            if(!input.value.trim()) return;
            if(!checkActionLimit('chats')) return;

            incrementStat('chats');
            
            const msgTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const msgHTML = `
                <div class="self-end bg-green-700 text-white p-3 rounded-2xl rounded-tr-none text-xs max-w-[85%] shadow-sm animate-slide-up">
                    <p>${input.value}</p>
                    <span class="text-[8px] text-green-200 block mt-1 text-left">${msgTime} <i class="fas fa-check-double"></i></span>
                </div>`;
            
            chatBox.innerHTML += msgHTML;
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            // Ø±Ø¯ Ø¢Ù„ÙŠ Ù„Ù„Ù…Ø­Ø§ÙƒØ§Ø©
            setTimeout(() => {
                const reply = `Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ Ø¨Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ. ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†Ø§ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„ØªØ¹Ø§Ø±Ù Ø§Ù„Ø±Ø³Ù…ÙŠØŸ`;
                chatBox.innerHTML += `
                    <div class="self-start bg-white border border-slate-200 text-slate-800 p-3 rounded-2xl rounded-tl-none text-xs max-w-[85%] shadow-sm">
                        <p>${reply}</p>
                        <span class="text-[8px] text-slate-400 block mt-1">${msgTime}</span>
                    </div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 1500);
        }

        function dismissNotif(id) {
            notifications = notifications.filter(n => n.id !== id);
            updateNotifBadge();
            renderNotifs();
        }

        function toggleNotif() {
            const p = document.getElementById('notifPanel');
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
        }

        function closeChat() { document.getElementById('chatWindow').style.display = 'none'; }

        function showToast(msg) {
            const t = document.getElementById('appToast');
            t.innerText = msg; t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        function filterMembers() {
            const val = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('.member-item').forEach(card => {
                const tags = card.getAttribute('data-tags').toLowerCase();
                card.style.display = tags.includes(val) ? 'flex' : 'none';
            });
        }

        function setFilter(type, el) {
            document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            const searchInput = document.getElementById('searchInput');
            searchInput.value = (type === 'all') ? '' : type;
            filterMembers();
        }

        function logout() { 
            if(confirm("ÙŠØ§ Ù…ØµØ¹Ø¨ØŒ Ù…ØªØ£ÙƒØ¯ Ø¯Ø§ÙŠØ± ØªØ³Ø¬Ù„ Ø®Ø±ÙˆØ¬ØŸ")) { 
                localStorage.clear(); 
                location.href = 'index.html'; 
            } 
        }

        window.onload = load;
    </script>
</body>
</html>
