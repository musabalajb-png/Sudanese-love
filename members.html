<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†ØµÙŠØ¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© ÙˆØ§Ù„Ù…Ø­ØµÙ†Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f0f4f8; overflow-x: hidden; }
        .member-card { border-radius: 2.5rem; background: white; transition: 0.4s; position: relative; border: 1.5px solid #eef2f6; overflow: hidden; }
        .gold-member { border: 2.3px solid #fbbf24 !important; box-shadow: 0 10px 20px rgba(251, 191, 36, 0.15); }
        .img-box { width: 100%; padding-top: 100%; position: relative; overflow: hidden; background: #f8fafc; }
        .img-box img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; transition: 0.5s; }
        .member-card:hover .img-box img { transform: scale(1.1); }
        .blur-effect { filter: blur(28px); transform: scale(1.1); }
        
        /* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø·Ø§Ø¦Ø±Ø© */
        .gift-anim { position: absolute; font-size: 2.5rem; animation: floatUp 1.5s ease-out forwards; z-index: 50; pointer-events: none; }
        @keyframes floatUp { 0% { bottom: 20%; opacity: 1; } 100% { bottom: 80%; opacity: 0; transform: scale(2) rotate(20deg); } }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .entry-heart { position: fixed; font-size: 24px; animation: entryFly 3s linear forwards; z-index: 9999; pointer-events: none; }
        @keyframes entryFly { 0% { transform: translateY(100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; } }
        
        .vip-tag { position: absolute; top: 10px; right: 10px; background: linear-gradient(90deg, #fbbf24, #f59e0b); color: white; padding: 2px 10px; border-radius: 20px; font-size: 9px; font-weight: bold; z-index: 10; shadow: 0 2px 5px rgba(0,0,0,0.2); }
    </style>
</head>
<body class="pb-10">

    <div id="giftBanner" class="bg-slate-900 text-white p-2 text-[10px] text-center font-bold">
        ğŸ <span id="bannerText">ÙŠØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©.. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ù†ØµÙŠØ¨Ùƒ Ø§Ù„ÙŠÙˆÙ…!</span>
    </div>

    <nav class="bg-white/80 backdrop-blur-md shadow-sm p-4 sticky top-0 z-50 flex justify-between items-center px-6 border-b border-green-50">
        <span class="font-bold text-green-700 text-lg flex items-center gap-2">ğŸ’ Ù†ØµÙŠØ¨</span>
        <div class="flex gap-2">
            <div class="bg-red-50 text-red-600 px-3 py-1 rounded-full text-[10px] font-bold border border-red-100">ğŸŒ¹ <span id="roseCount">10</span></div>
            <div class="bg-blue-50 text-blue-600 px-3 py-1 rounded-full text-[10px] font-bold border border-blue-100">ğŸ’Œ <span id="msgCount">3</span></div>
        </div>
    </nav>

    <div class="container mx-auto p-4 grid grid-cols-2 md:grid-cols-4 gap-6" id="membersGrid">
        </div>

    <div id="chatBox" class="hidden fixed inset-0 bg-black/70 backdrop-blur-md z-[100] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl overflow-hidden relative border-t-4 border-green-500">
            <div id="chatAvatar" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-green-50 overflow-hidden shadow-inner"></div>
            <h3 id="targetName" class="font-bold text-center text-xl mb-6 text-slate-800"></h3>
            
            <textarea id="msgInput" placeholder="Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ø¹Ø¬Ø§Ø¨ Ù…Ø­ØªØ±Ù…Ø©..." class="w-full h-28 p-5 bg-slate-50 rounded-[2rem] border-none outline-none text-sm resize-none focus:ring-2 focus:ring-green-400 transition"></textarea>
            
            <p id="errorMsg" class="text-red-500 text-[10px] mt-2 hidden text-center font-bold">ğŸ›‘ Ø§Ù„ØªØ²Ø§Ù…Ø§Ù‹ Ø¨Ø§Ù„Ø³ØªØ±.. ÙŠÙ…Ù†Ø¹ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ØºÙŠØ± Ø§Ù„Ù„Ø§Ø¦Ù‚Ø©.</p>
            
            <div class="grid grid-cols-2 gap-3 mt-6">
                <button id="sendBtn" onclick="sendLiveMessage()" class="bg-green-600 text-white py-4 rounded-2xl font-bold text-xs shadow-lg hover:bg-green-700 transition">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
                <button onclick="closeChat()" class="bg-slate-100 text-slate-500 py-4 rounded-2xl font-bold text-xs">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù‡ÙˆÙŠØ© ---
        if (localStorage.getItem('naseeb_logged') !== 'true') { window.location.href = 'index.html'; }

        // --- 2. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ø¨ØµØ±ÙŠØ© ---
        function handleDailySystems() {
            const today = new Date().toDateString();
            if (localStorage.getItem('lastVisitDate') !== today) {
                localStorage.setItem('roses', '10');
                localStorage.setItem('msgs', '3');
                localStorage.setItem('lastVisitDate', today);
            }

            const userPlan = localStorage.getItem('userPlan') || "";
            if(/Ø§Ù„Ø³ØªØ±|Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(userPlan)) {
                launchEntryHearts(); // ØªØ´ØºÙŠÙ„ Ø§Ù„Ù‚Ù„ÙˆØ¨ Ø§Ù„Ø·Ø§Ø¦Ø±Ø© Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†
                document.getElementById('bannerText').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.. ØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ù‡Ø¯Ø§ÙŠØ§Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­! ğŸ";
            }
        }

        function launchEntryHearts() {
            const symbols = ['â¤ï¸', 'ğŸŒ¹', 'ğŸ’–', 'âœ¨'];
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const h = document.createElement('div');
                    h.className = 'entry-heart';
                    h.innerHTML = symbols[Math.floor(Math.random()*symbols.length)];
                    h.style.left = Math.random() * 100 + 'vw';
                    h.style.animationDuration = (Math.random()*2 + 2) + 's';
                    document.body.appendChild(h);
                    setTimeout(() => h.remove(), 3000);
                }, i * 200);
            }
        }

        // --- 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ÙˆØ§Ø¬Ù‡Ø© ---
        const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHsoqVm7cDIUgGw6u5n0yO8U19lyqKLrrskUn6Q7At1Q04hrXdC7HxojsDnxj7Frld2__eJOBBMEX6/pub?output=csv";

        async function load() {
            handleDailySystems();
            const res = await fetch(sheetURL);
            const data = await res.text();
            const rows = data.split('\n').slice(1);
            const isPaid = /Ø§Ù„Ø³ØªØ±|Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(localStorage.getItem('userPlan'));

            rows.forEach((row, index) => {
                const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)?.map(c => c.replace(/"/g, '').trim()) || [];
                if(cols.length < 5) return;
                const name = cols[0], img = cols[6], plan = cols[5];
                const isGold = /Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(plan);

                document.getElementById('membersGrid').innerHTML += `
                    <div class="member-card ${isGold ? 'gold-member' : ''}" id="card-${index}">
                        ${isGold ? '<span class="vip-tag">VIP</span>' : ''}
                        <div class="img-box">
                            <img src="${img}" class="${isPaid ? '' : 'blur-effect'}" loading="lazy" onerror="this.src='https://ui-avatars.com/api/?name=${name}'">
                        </div>
                        <div class="p-4 text-center">
                            <h4 class="font-bold text-[10px] mb-3 text-slate-600">${name}</h4>
                            <div class="flex flex-wrap gap-2 justify-center">
                                <button onclick="dropGift('card-${index}', 'ğŸŒ¹')" class="bg-red-50 p-2 rounded-xl text-sm hover:scale-110 transition">ğŸŒ¹</button>
                                <button onclick="openChat('${name}', '${img}')" class="bg-blue-600 text-white px-3 py-1 rounded-xl text-[9px] font-bold shadow-md">Ø¥Ø¹Ø¬Ø§Ø¨ ğŸ’Œ</button>
                                <button onclick="requestVideo('${name}')" class="bg-amber-100 text-amber-700 p-2 rounded-xl text-xs hover:bg-amber-200 transition">
                                    <i class="fas fa-video"></i>
                                </button>
                            </div>
                        </div>
                    </div>`;
            });
            updateUI();
        }

        function updateUI() {
            document.getElementById('roseCount').innerText = localStorage.getItem('roses') || 10;
            document.getElementById('msgCount').innerText = localStorage.getItem('msgs') || 3;
        }

        // --- 4. Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ ÙˆØ§Ù„Ø£Ù…Ø§Ù† Ø§Ù„Ù…Ø·ÙˆØ± ---
        function dropGift(cardId, emoji) {
            let r = parseInt(localStorage.getItem('roses'));
            if(r <= 0) return alert("Ù†ÙØ¯ Ø±ØµÙŠØ¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù…Ù† Ø§Ù„ÙˆØ±Ø¯.. Ù†Ù„Ù‚Ø§Ùƒ ØºØ¯Ø§Ù‹ Ø£Ùˆ Ø§Ø´ØªØ±Ùƒ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø±ØµÙŠØ¯! ğŸŒ¹");
            
            localStorage.setItem('roses', r - 1);
            updateUI();
            const card = document.getElementById(cardId);
            const gift = document.createElement('div');
            gift.className = 'gift-anim'; gift.innerHTML = emoji; gift.style.left = "40%";
            card.appendChild(gift);
            setTimeout(() => gift.remove(), 1500);
        }

        let activeName = "";
        function openChat(name, img) {
            activeName = name;
            document.getElementById('targetName').innerText = name;
            document.getElementById('chatAvatar').innerHTML = `<img src="${img}" class="w-full h-full object-cover">`;
            document.getElementById('chatBox').classList.remove('hidden');
            document.getElementById('errorMsg').classList.add('hidden');
        }

        function closeChat() { document.getElementById('chatBox').classList.add('hidden'); }

        function sendLiveMessage() {
            const btn = document.getElementById('sendBtn');
            let m = parseInt(localStorage.getItem('msgs'));
            if(m <= 0) return alert("Ù†ÙØ¯ Ø±ØµÙŠØ¯ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ’Œ");

            const input = document.getElementById('msgInput').value;
            // ÙÙ„ØªØ± Ø£Ù…Ø§Ù† Ù…Ø·ÙˆØ± ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…ØŒ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„Ø§ØªØŒ ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª ØºÙŠØ± Ø§Ù„Ù„Ø§Ø¦Ù‚Ø©
            const forbidden = /[0-9]{7,}|09[0-9]|01[0-9]|@|\.com|ÙƒÙ„Ø¨|Ø­Ù…Ø§Ø±|ÙˆØ³Ø®/i; 
            
            if(forbidden.test(input)) {
                const err = document.getElementById('errorMsg');
                err.classList.remove('hidden');
                err.innerText = "ğŸ›‘ Ù…Ø­ØªÙˆÙ‰ Ù…Ø®Ø§Ù„Ù Ù„Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø³ØªØ± (ÙŠÙ…Ù†Ø¹ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…)";
                return;
            }
            
            if(input.length < 5) return alert("Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‚ØµÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹!");

            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
            localStorage.setItem('msgs', m - 1);
            updateUI();

            setTimeout(() => {
                alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ù„Ù€ ${activeName} Ø¨Ù†Ø¬Ø§Ø­ âœ…`);
                closeChat();
                btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ ğŸš€";
                document.getElementById('msgInput').value = "";
            }, 1000);
        }

        function requestVideo(name) {
            const isPaid = /Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(localStorage.getItem('userPlan'));
            if(!isPaid) {
                alert("Ø®Ø¯Ù…Ø© Ù…ÙƒØ§Ù„Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…ØªØ§Ø­Ø© ÙÙ‚Ø· Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† (Ø¨Ø§Ù‚Ø© Ø°Ù‡Ø¨ÙŠØ©/Ù…Ø§Ø³ÙŠØ©) Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ© ğŸ¥");
                return;
            }
            const msg = `Ø·Ù„Ø¨ ØªÙˆØ§ØµÙ„ ÙÙŠØ¯ÙŠÙˆ: Ø£Ù†Ø§ Ø§Ù„Ù…Ø´ØªØ±Ùƒ (${localStorage.getItem('userName')}) Ø£Ø±ØºØ¨ ÙÙŠ Ù…ÙƒØ§Ù„Ù…Ø© ÙÙŠØ¯ÙŠÙˆ Ù…Ø¹ Ø§Ù„Ø·Ø±Ù (${name}) ØªØ­Øª Ø¥Ø´Ø±Ø§Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.`;
            window.open(`https://wa.me/249127910778?text=${encodeURIComponent(msg)}`, '_blank');
        }

        window.onload = load;
    </script>
</body>
</html>
