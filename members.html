<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†ØµÙŠØ¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ | Ù…Ù†ØµØ© Ø§Ù„ØªÙØ§Ø¹Ù„ Ø§Ù„Ø¢Ù…Ù†Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #f0f4f8; overflow-x: hidden; }
        .member-card { border-radius: 2.5rem; background: white; transition: 0.4s; position: relative; border: 1.5px solid #eef2f6; overflow: hidden; display: flex; flex-direction: column; cursor: pointer; }
        .gold-member { border: 2.3px solid #fbbf24 !important; box-shadow: 0 10px 25px rgba(251, 191, 36, 0.2); }
        .img-box { width: 100%; padding-top: 110%; position: relative; overflow: hidden; background: #f8fafc; }
        .img-box img { position: absolute; top:0; left:0; width:100%; height:100%; object-fit: cover; transition: 0.6s ease; }
        .member-card:hover .img-box img { transform: scale(1.08); }
        .blur-effect { filter: blur(30px); transform: scale(1.1); }
        
        .gift-anim { position: absolute; font-size: 2.5rem; animation: floatUp 1.5s ease-out forwards; z-index: 50; pointer-events: none; }
        @keyframes floatUp { 0% { bottom: 20%; opacity: 1; } 100% { bottom: 85%; opacity: 0; transform: scale(2.5) rotate(15deg); } }
        
        .entry-heart { position: fixed; font-size: 24px; animation: entryFly 3.5s linear forwards; z-index: 9999; pointer-events: none; }
        @keyframes entryFly { 0% { transform: translateY(100vh) rotate(0deg); opacity: 1; } 100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; } }
        
        .vip-tag { position: absolute; top: 12px; right: 12px; background: linear-gradient(135deg, #fbbf24, #d97706); color: white; padding: 3px 12px; border-radius: 20px; font-size: 10px; font-weight: bold; z-index: 10; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .online-dot { position: absolute; bottom: 12px; left: 12px; width: 10px; height: 10px; background: #22c55e; border-radius: 50%; border: 2px white solid; z-index: 10; }
        
        .search-container { background: white; border-radius: 1.5rem; padding: 10px 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
    </style>
</head>
<body class="pb-10">

    <div id="giftBanner" class="bg-gradient-to-r from-slate-900 to-slate-800 text-white p-2 text-[10px] text-center font-bold tracking-wide">
        âœ¨ <span id="bannerText">ÙŠØªÙ… ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©.. Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ù†ØµÙŠØ¨Ùƒ Ø§Ù„ÙŠÙˆÙ…!</span>
    </div>

    <nav class="bg-white/90 backdrop-blur-md shadow-sm p-4 sticky top-0 z-50 border-b border-green-50">
        <div class="container mx-auto flex justify-between items-center px-4">
            <span class="font-bold text-green-700 text-xl flex items-center gap-2">ğŸ’ Ù†ØµÙŠØ¨</span>
            <div class="flex gap-2">
                <div class="bg-red-50 text-red-600 px-4 py-1.5 rounded-full text-[11px] font-bold border border-red-100 flex items-center gap-1">
                    <span>ğŸŒ¹</span> <span id="roseCount">10</span>
                </div>
                <div class="bg-blue-50 text-blue-600 px-4 py-1.5 rounded-full text-[11px] font-bold border border-blue-100 flex items-center gap-1">
                    <span>ğŸ’Œ</span> <span id="msgCount">3</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 mt-2">
        <div class="search-container flex items-center gap-3">
            <i class="fas fa-search text-slate-400"></i>
            <input type="text" id="searchInput" onkeyup="filterMembers()" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„Ø®Ø±Ø·ÙˆÙ…)..." class="w-full outline-none text-sm text-slate-700 bg-transparent">
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mt-4" id="membersGrid"></div>
    </div>

    <div id="chatBox" class="hidden fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl relative border-t-8 border-green-600 transition-all transform scale-100">
            <div id="chatAvatar" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-green-50 overflow-hidden shadow-lg bg-slate-100"></div>
            <h3 id="targetName" class="font-bold text-center text-xl mb-4 text-slate-800"></h3>
            <textarea id="msgInput" placeholder="Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ø¹Ø¬Ø§Ø¨ Ù…Ø­ØªØ±Ù…Ø©..." class="w-full h-28 p-5 bg-slate-50 rounded-[2rem] border border-slate-100 outline-none text-sm resize-none focus:ring-2 focus:ring-green-400 focus:bg-white transition"></textarea>
            <p id="errorMsg" class="text-red-500 text-[10px] mt-3 hidden text-center font-bold px-2">ğŸ›‘ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø³ØªØ± ØªÙ…Ù†Ø¹ ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø§Ù„ÙƒÙ„Ù…Ø§Øª ØºÙŠØ± Ø§Ù„Ù„Ø§Ø¦Ù‚Ø©.</p>
            <div class="grid grid-cols-2 gap-4 mt-6">
                <button id="sendBtn" onclick="sendLiveMessage()" class="bg-green-600 text-white py-4 rounded-2xl font-bold text-sm shadow-lg hover:bg-green-700 active:scale-95 transition">Ø¥Ø±Ø³Ø§Ù„ ğŸš€</button>
                <button onclick="closeChat()" class="bg-slate-100 text-slate-500 py-4 rounded-2xl font-bold text-sm hover:bg-slate-200 transition">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ­Ù‚Ù‚ ---
        if (localStorage.getItem('naseeb_logged') !== 'true') { window.location.href = 'index.html'; }

        // --- 2. Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« ---
        function filterMembers() {
            let input = document.getElementById('searchInput').value.toLowerCase();
            let cards = document.getElementsByClassName('member-card');
            for (let card of cards) {
                let name = card.getAttribute('data-name').toLowerCase();
                let city = card.getAttribute('data-city').toLowerCase();
                card.style.display = (name.includes(input) || city.includes(input)) ? "" : "none";
            }
        }

        // --- 3. Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ ---
        function handleDailySystems() {
            const today = new Date().toDateString();
            if (localStorage.getItem('lastVisitDate') !== today) {
                localStorage.setItem('roses', '10');
                localStorage.setItem('msgs', '3');
                localStorage.setItem('lastVisitDate', today);
            }
            if(/Ø§Ù„Ø³ØªØ±|Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(localStorage.getItem('userPlan'))) {
                setTimeout(launchEntryHearts, 500);
            }
        }

        function launchEntryHearts() {
            const symbols = ['â¤ï¸', 'ğŸŒ¹', 'ğŸ’–', 'âœ¨'];
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const h = document.createElement('div');
                    h.className = 'entry-heart';
                    h.innerHTML = symbols[Math.floor(Math.random()*symbols.length)];
                    h.style.left = Math.random() * 100 + 'vw';
                    document.body.appendChild(h);
                    setTimeout(() => h.remove(), 4000);
                }, i * 150);
            }
        }

        // --- 4. ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ---
        function viewProfile(dataStr) {
            const data = JSON.parse(decodeURIComponent(dataStr));
            sessionStorage.setItem('currentProfile', JSON.stringify(data));
            window.location.href = 'profile.html';
        }

        // --- 5. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        const sheetURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRHsoqVm7cDIUgGw6u5n0yO8U19lyqKLrrskUn6Q7At1Q04hrXdC7HxojsDnxj7Frld2__eJOBBMEX6/pub?output=csv";

        async function load() {
            handleDailySystems();
            try {
                const res = await fetch(sheetURL);
                const data = await res.text();
                const rows = data.split('\n').slice(1);
                const grid = document.getElementById('membersGrid');
                const isPaid = /Ø§Ù„Ø³ØªØ±|Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(localStorage.getItem('userPlan'));

                rows.forEach((row, index) => {
                    const cols = row.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g)?.map(c => c.replace(/"/g, '').trim()) || [];
                    if(cols.length < 5) return;
                    
                    // ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ Ù„ÙƒØ§Ø¦Ù† JSON Ù„Ø³Ù‡ÙˆÙ„Ø© Ù†Ù‚Ù„Ù‡Ø§ Ù„ØµÙØ­Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
                    const memberData = {
                        name: cols[0],
                        age: cols[1],
                        city: cols[2],
                        status: cols[3] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        job: cols[4] || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        plan: cols[5],
                        img: cols[6],
                        height: cols[7] || '--',
                        weight: cols[8] || '--',
                        skin: cols[9] || '--'
                    };
                    const dataStr = encodeURIComponent(JSON.stringify(memberData));

                    grid.innerHTML += `
                        <div class="member-card ${memberData.plan.includes('Ø°Ù‡Ø¨ÙŠØ©') ? 'gold-member' : ''}" id="card-${index}" data-name="${memberData.name}" data-city="${memberData.city}">
                            ${memberData.plan.includes('Ø°Ù‡Ø¨ÙŠØ©') ? '<span class="vip-tag"><i class="fas fa-crown"></i> VIP</span>' : ''}
                            <div class="img-box" onclick="viewProfile('${dataStr}')">
                                <div class="online-dot"></div>
                                <img src="${memberData.img}" class="${isPaid ? '' : 'blur-effect'}" loading="lazy" onerror="this.src='https://ui-avatars.com/api/?name=${memberData.name}'">
                            </div>
                            <div class="p-4 text-center">
                                <h4 class="font-bold text-[11px] text-slate-700 truncate" onclick="viewProfile('${dataStr}')">${memberData.name}</h4>
                                <p class="text-[9px] text-slate-400 mb-3"><i class="fas fa-map-marker-alt"></i> ${memberData.city}</p>
                                <div class="flex gap-2 justify-center">
                                    <button onclick="event.stopPropagation(); dropGift('card-${index}', 'ğŸŒ¹')" class="bg-red-50 text-red-600 p-2.5 rounded-2xl text-sm">ğŸŒ¹</button>
                                    <button onclick="event.stopPropagation(); openChat('${memberData.name}', '${memberData.img}')" class="bg-green-600 text-white px-4 py-2 rounded-2xl text-[10px] font-bold flex-1">ğŸ’Œ Ø¥Ø¹Ø¬Ø§Ø¨</button>
                                    <button onclick="event.stopPropagation(); requestVideo('${memberData.name}')" class="bg-amber-100 text-amber-600 p-2.5 rounded-2xl text-sm">
                                        <i class="fas fa-video"></i>
                                    </button>
                                </div>
                            </div>
                        </div>`;
                });
                updateUI();
            } catch (e) { console.error(e); }
        }

        function updateUI() {
            document.getElementById('roseCount').innerText = localStorage.getItem('roses') || 0;
            document.getElementById('msgCount').innerText = localStorage.getItem('msgs') || 0;
        }

        function dropGift(cardId, emoji) {
            let r = parseInt(localStorage.getItem('roses'));
            if(r <= 0) return alert("Ø§Ù†ØªÙ‡Ù‰ Ø±ØµÙŠØ¯ Ø§Ù„ÙˆØ±Ø¯ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… ğŸŒ¹");
            localStorage.setItem('roses', r - 1);
            updateUI();
            const card = document.getElementById(cardId);
            const gift = document.createElement('div');
            gift.className = 'gift-anim'; gift.innerHTML = emoji; gift.style.left = "45%";
            card.appendChild(gift);
            setTimeout(() => gift.remove(), 1500);
        }

        let activeName = "";
        function openChat(name, img) {
            activeName = name;
            document.getElementById('targetName').innerText = "ØªÙˆØ§ØµÙ„ Ù…Ø¹ " + name;
            document.getElementById('chatAvatar').innerHTML = `<img src="${img}" class="w-full h-full object-cover">`;
            document.getElementById('chatBox').classList.remove('hidden');
        }

        function closeChat() { document.getElementById('chatBox').classList.add('hidden'); }

        function sendLiveMessage() {
            const btn = document.getElementById('sendBtn');
            let m = parseInt(localStorage.getItem('msgs'));
            if(m <= 0) return alert("Ù†ÙØ¯ Ø±ØµÙŠØ¯ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ ğŸ’Œ");
            const input = document.getElementById('msgInput').value;
            const forbidden = /[0-9]{7,}|09[0-9]|01[0-9]|@|\.com|ÙƒÙ„Ø¨|Ø­Ù…Ø§Ø±|ÙˆØ§ØªØ³Ø§Ø¨/i; 
            if(forbidden.test(input)) { document.getElementById('errorMsg').classList.remove('hidden'); return; }
            btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";
            localStorage.setItem('msgs', m - 1);
            updateUI();
            setTimeout(() => {
                alert(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­ âœ…`);
                closeChat();
                btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ ğŸš€";
                document.getElementById('msgInput').value = "";
            }, 1200);
        }

        function requestVideo(name) {
            const isPaid = /Ø°Ù‡Ø¨ÙŠØ©|Ù…Ø§Ø³ÙŠØ©/i.test(localStorage.getItem('userPlan'));
            if(!isPaid) return alert("Ø·Ù„Ø¨ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† ÙÙ‚Ø· ğŸ¥");
            window.open(`https://wa.me/249127910778?text=Ø·Ù„Ø¨ ÙÙŠØ¯ÙŠÙˆ Ù…Ø¹ ${name}`, '_blank');
        }

        window.onload = load;
    </script>
</body>
</html>
