<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุณุฌูู ุนุถููุฉ ุฌุฏูุฏุฉ - ูุตูุจ ุงูุนุงููู</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/css/intlTelInput.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Cairo', sans-serif; background: #fdfdfd; }
        .iti { width: 100%; }
        input, select, textarea { border: 1px solid #e5e7eb !important; transition: 0.3s; }
        input:focus, select:focus { border-color: #15803d !important; box-shadow: 0 0 0 3px rgba(21, 128, 61, 0.1) !important; }
        .bank-card { background: linear-gradient(135deg, #006a4d 0%, #004d38 100%); border-radius: 1.5rem; }
        .step-shadow { box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.08); }
    </style>
</head>
<body class="min-h-screen pb-12">

    <nav class="bg-white/80 backdrop-blur-md shadow-sm p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center px-4">
            <h1 class="text-2xl font-bold text-green-700">๐ ูุตูุจ ุงูุนุงููู</h1>
            <a href="index.html" class="text-gray-500 font-bold hover:text-green-700 text-sm transition">ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ</a>
        </div>
    </nav>

    <div class="container mx-auto px-4 mt-8 max-w-2xl">
        <div class="bg-white rounded-[3rem] step-shadow overflow-hidden border border-green-50">
            <div class="bg-green-700 p-8 text-center text-white relative">
                <h2 class="text-2xl font-bold mb-2">ุฅุณุชูุงุฑุฉ ุชุณุฌูู ุงููุดุชุฑููู</h2>
                <p class="text-green-100 text-sm">ุจูุงูุงุชู ูุญุงุทุฉ ุจุฎุตูุตูุฉ ุชุงูุฉ ููู ุงูุดุฑูุนุฉ</p>
            </div>

            <form id="registrationForm" action="https://formspree.io/f/mdandyav" method="POST" class="p-8 space-y-6">
                
                <div class="bg-slate-50 p-6 rounded-3xl border border-slate-100">
                    <label class="block text-sm font-bold text-gray-700 mb-3 text-center">ุงุฎุชุฑ ููุน ุงูุนุถููุฉ ุงููุทููุจุฉ *</label>
                    <select id="selectedPlan" name="plan" required class="w-full p-4 rounded-2xl outline-none bg-white font-bold text-green-800 cursor-pointer text-center">
                        <option value="" disabled selected>ุงุถุบุท ููุงุฎุชูุงุฑ...</option>
                        <option value="ุงูุณุชุฑ">ุจุงูุฉ ุงูุณุชุฑ (15,000 SDG)</option>
                        <option value="ุงูุฐูุจูุฉ">ุงูุจุงูุฉ ุงูุฐูุจูุฉ (35,000 SDG)</option>
                        <option value="ุงููุงุณูุฉ">ุงูุจุงูุฉ ุงููุงุณูุฉ (75,000 SDG)</option>
                    </select>
                </div>

                <div id="paymentSection" class="hidden space-y-4">
                    <div class="bank-card p-6 text-white shadow-xl">
                        <div class="flex justify-between text-xs opacity-80 mb-2"><span>ุชุทุจูู ุจููู</span><span>ุญุณุงุจ ุงูุชูุซูู</span></div>
                        <div class="flex justify-between items-center">
                            <h3 id="accNum" class="text-2xl font-mono font-bold tracking-tighter">1705644</h3>
                            <button type="button" onclick="copyAccount()" class="bg-white/20 hover:bg-white/40 px-3 py-1 rounded-lg text-xs transition">ูุณุฎ ๐</button>
                        </div>
                        <p class="text-[10px] mt-2 opacity-90">ุจุงุณู: ูุตุนุจ - ูุตูุจ ุงูุนุงููู</p>
                    </div>
                    <div class="p-4 bg-yellow-50 border border-yellow-100 rounded-2xl">
                        <label class="block text-xs font-bold text-yellow-700 mb-2">ุงุฑูุงู ุตูุฑุฉ ุฅูุตุงู ุงูุชุญููู (ููู ุฌุฏุงู ููุชูุซูู)</label>
                        <input type="file" id="receiptInput" accept="image/*" class="w-full text-xs text-gray-500">
                        <input type="hidden" name="receipt_url" id="receiptUrl">
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" name="name" required placeholder="ุงูุงุณู ุงููุณุชุนุงุฑ (ูุธูุฑ ููุนุงูุฉ)" class="w-full p-4 rounded-2xl bg-slate-50">
                    <input type="text" name="origin" required placeholder="ุงููุจููุฉ / ุงูุฃุตู" class="w-full p-4 rounded-2xl bg-slate-50">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[10px] mr-2 text-gray-400">ุฑูู ุงููุงุชุณุงุจ (ููุชูุงุตู ุงูุฅุฏุงุฑู)</label>
                        <input type="tel" id="phone" required class="w-full p-4 rounded-2xl bg-slate-50" dir="ltr">
                        <input type="hidden" name="whatsapp_full" id="whatsapp_full">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] mr-2 text-gray-400">ููุงู ุงูุฅูุงูุฉ ุงูุญุงูู</label>
                        <input type="text" name="city" required placeholder="ุงูุฏููุฉ - ุงููุฏููุฉ" class="w-full p-4 rounded-2xl bg-slate-50">
                    </div>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <input type="number" name="age" required placeholder="ุงูุนูุฑ" class="p-4 rounded-2xl bg-slate-50">
                    <input type="number" name="height" required placeholder="ุงูุทูู (ุณู)" class="p-4 rounded-2xl bg-slate-50">
                    <input type="number" name="weight" required placeholder="ุงููุฒู" class="p-4 rounded-2xl bg-slate-50">
                    <select name="gender" required class="p-4 rounded-2xl bg-slate-50">
                        <option value="ุฐูุฑ">ุฐูุฑ</option>
                        <option value="ุฃูุซู">ุฃูุซู</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <select name="status" required class="p-4 rounded-2xl bg-slate-50 font-bold">
                        <option value="ุฃุนุฒุจ">ุงูุญุงูุฉ: ุฃุนุฒุจ/ุนุฒุจุงุก</option>
                        <option value="ูุทูู">ูุทูู/ุฉ</option>
                        <option value="ุฃุฑูู">ุฃุฑูู/ุฉ</option>
                        <option value="ุชุนุฏุฏ">ุทูุจ ุชุนุฏุฏ</option>
                    </select>
                    <input type="text" name="education" required placeholder="ุงููุณุชูู ุงูุชุนูููู / ุงููุธููุฉ" class="w-full p-4 rounded-2xl bg-slate-50">
                </div>

                <div class="p-6 border-2 border-dashed border-green-100 rounded-3xl text-center">
                    <p class="text-xs font-bold text-green-700 mb-3">ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ (ุณุชููู ูุฎููุฉ Blur)</p>
                    <input type="file" id="imageInput" accept="image/*" required class="text-xs">
                    <input type="hidden" name="profile_image" id="imageUrl">
                </div>

                <div class="bg-blue-50 p-6 rounded-3xl">
                    <label class="block text-sm font-bold text-blue-700 mb-2">ูููุฉ ุณุฑ ูุญุณุงุจู *</label>
                    <input type="password" name="password" id="userPassword" required placeholder="ุณุชุญุชุงุฌูุง ูุชุนุฏูู ุจูุงูุงุชู ูุงุญูุงู" class="w-full p-4 rounded-2xl border-none">
                </div>

                <button type="submit" id="submitBtn" class="w-full bg-green-700 text-white font-bold py-5 rounded-2xl shadow-xl hover:bg-green-800 transition-all flex items-center justify-center gap-3">
                    <span id="btnText">ุฅุฑุณุงู ุงูุจูุงูุงุช ูุงูุชูุซูู</span>
                    <span id="loader" class="hidden animate-spin border-2 border-white/30 border-t-white rounded-full w-5 h-5"></span>
                </button>
                <p id="statusMsg" class="text-center text-xs font-bold opacity-0 transition-opacity"></p>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/intlTelInput.min.js"></script>
    <script>
        const IMGBB_API_KEY = "ef5f93c776a98bfd2a4ef1d6cdeba6bf";
        const form = document.getElementById("registrationForm");
        const phoneInputField = document.querySelector("#phone");
        const phoneInput = window.intlTelInput(phoneInputField, {
            preferredCountries: ["sd", "sa", "ae", "eg", "qa"],
            utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",
        });

        // ุฅุธูุงุฑ ูุณู ุงูุฏูุน
        document.getElementById('selectedPlan').addEventListener('change', function() {
            document.getElementById('paymentSection').style.display = 'block';
        });

        function copyAccount() {
            navigator.clipboard.writeText('1705644');
            alert('ุชู ูุณุฎ ุฑูู ุงูุญุณุงุจ ๐');
        }

        async function uploadToImgBB(file) {
            if (!file) return null;
            const formData = new FormData();
            formData.append('image', file);
            const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                method: 'POST', body: formData
            });
            const data = await response.json();
            return data.success ? data.data.url : null;
        }

        form.addEventListener("submit", async function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            const loader = document.getElementById('loader');
            const status = document.getElementById('statusMsg');

            btn.disabled = true;
            loader.classList.remove('hidden');
            status.style.opacity = "1";
            status.innerText = "โณ ุฌุงุฑู ุงููุนุงูุฌุฉ ูุงูุฑูุน...";
            status.className = "text-center text-xs font-bold mt-4 text-blue-600";

            try {
                // 1. ุฑูุน ุงูุตูุฑุฉ ุงูุดุฎุตูุฉ
                const profileUrl = await uploadToImgBB(document.getElementById('imageInput').files[0]);
                document.getElementById('imageUrl').value = profileUrl;

                // 2. ุฑูุน ุตูุฑุฉ ุงูุฅูุตุงู (ุงุฎุชูุงุฑู ุญุณุจ ุงูุจุงูุฉ)
                const receiptUrl = await uploadToImgBB(document.getElementById('receiptInput').files[0]);
                document.getElementById('receiptUrl').value = receiptUrl;

                document.getElementById('whatsapp_full').value = phoneInput.getNumber();

                // 3. ุฅุฑุณุงู ูู Formspree
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form),
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    // 4. ุญูุธ ุงูุฌูุณุฉ ูุญููุงู (Login Simulation)
                    localStorage.setItem('naseeb_user', form.name.value);
                    localStorage.setItem('naseeb_logged', 'true');

                    status.innerText = "โ ุชู ุงูุฅุฑุณุงู! ุฌุงุฑู ุชูุซูู ุงูุทูุจ ุนุจุฑ ูุงุชุณุงุจ...";
                    status.className = "text-center text-xs font-bold mt-4 text-green-600";
                    
                    const waMsg = `ุทูุจ ุชุณุฌูู ุฌุฏูุฏ ูู ูุตูุจ ุงูุนุงููู\n๐ค ุงูุงุณู: ${form.name.value}\n๐ ุงูุฅูุงูุฉ: ${form.city.value}\n๐ฐ ุงูุจุงูุฉ: ${form.plan.value}\n๐ผ๏ธ ุงูุตูุฑุฉ: ${profileUrl}\n๐งพ ุงูุฅูุตุงู: ${receiptUrl || 'ูุง ููุฌุฏ'}`;
                    
                    window.open(`https://wa.me/249127910778?text=${encodeURIComponent(waMsg)}`, '_blank');
                    
                    setTimeout(() => window.location.href = "index.html", 4000);
                }
            } catch (err) {
                status.innerText = "โ ูุดู ุงูุฅุฑุณุงูุ ุชุฃูุฏ ูู ุงูุงุชุตุงู ูุญุงูู ูุฌุฏุฏุงู";
                status.className = "text-center text-xs font-bold mt-4 text-red-600";
                btn.disabled = false;
                loader.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
