<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ†Ø§ | Ù†ØµÙŠØ¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
    
    <style>
        :root { --primary-green: #15803d; --accent-gold: #fbbf24; --bankak-blue: #0072ce; }
        body { font-family: 'Cairo', sans-serif; background: #f0fdf4; min-height: 100vh; user-select: none; }
        
        .step-content { display: none; animation: slideIn 0.4s ease-out; }
        .step-content.active { display: block; }
        @keyframes slideIn { from { transform: translateX(50px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        .progress-dot { width: 10px; height: 10px; border-radius: 50%; background: #d1d5db; transition: 0.4s; }
        .progress-dot.active { background: var(--primary-green); transform: scale(1.5); box-shadow: 0 0 10px rgba(21, 128, 61, 0.4); }

        #passStrength { height: 4px; border-radius: 2px; transition: 0.3s; width: 0%; margin-top: 5px; }
        
        .live-preview-card { background: white; border-radius: 2rem; overflow: hidden; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); transition: 0.3s; }
        
        #termsModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        #termsModal.active { display: flex; }

        .otp-input { width: 45px; height: 55px; text-align: center; font-size: 1.5rem; font-weight: bold; border-radius: 12px; border: 2px solid #e2e8f0; background: #f8fafc; }
        .otp-input:focus { border-color: var(--primary-green); outline: none; background: white; }
        .form-input {
            width: 100%; padding: 1.25rem; padding-left: 3rem; border-radius: 1.25rem; background-color: #f1f5f9;
            border: 2px solid transparent; font-weight: 700; outline: none; transition: all 0.3s;
        }
        .form-input:focus { border-color: var(--primary-green); background-color: white; }
        .form-input.error { border-color: #ef4444; }
        .error-message { color: #ef4444; font-size: 0.8rem; font-weight: bold; margin-top: 0.5rem; display: none; }
    </style>
</head>
<body class="p-4 md:p-10">

    <div id="termsModal">
        <!-- ... (Modal content remains the same) ... -->
    </div>

    <div class="max-w-5xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-10 items-start">
        
        <div class="hidden lg:block sticky top-10">
            <p class="text-slate-500 font-bold mb-4 text-center">Ù‡ÙƒØ°Ø§ Ø³ÙŠØ¸Ù‡Ø± Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ùƒ Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡ ğŸ¤³</p>
            <div class="live-preview-card border border-white">
                <div class="relative h-80 bg-slate-200 overflow-hidden">
                    <img id="previewImg" src="https://ui-avatars.com/api/?name=User&background=cbd5e1" class="w-full h-full object-cover blur-[20px]">
                    <div class="absolute bottom-0 w-full p-6 bg-gradient-to-t from-black/80 to-transparent text-white">
                        <h3 id="previewName" class="text-2xl font-black">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±</h3>
                        <p id="previewCity" class="text-xs font-bold text-slate-300">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</p>
                    </div>
                </div>
                <div class="p-6 grid grid-cols-3 gap-2">
                    <div class="bg-slate-50 p-3 rounded-xl text-center"><p class="text-[9px] text-slate-400 font-bold">Ø§Ù„Ø¹Ù…Ø±</p><b id="previewAge" class="text-xs text-slate-700">-</b></div>
                    <div class="bg-slate-50 p-3 rounded-xl text-center"><p class="text-[9px] text-slate-400 font-bold">Ø§Ù„Ù…Ù‡Ù†Ø©</p><b id="previewJob" class="text-xs text-slate-700">-</b></div>
                    <div class="bg-slate-50 p-3 rounded-xl text-center"><p class="text-[9px] text-slate-400 font-bold">Ø§Ù„Ø­Ø§Ù„Ø©</p><b id="previewStatus" class="text-xs text-slate-700">-</b></div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-[3rem] shadow-2xl p-8 md:p-10 border border-slate-100 relative overflow-hidden">
            
            <div class="flex justify-between items-center mb-10 px-4">
                <div class="progress-dot active" id="dot1"></div>
                <div class="h-1 flex-1 bg-gray-100 mx-2"><div id="line1" class="h-full bg-green-700 transition-all w-0"></div></div>
                <div class="progress-dot" id="dot2"></div>
                <div class="h-1 flex-1 bg-gray-100 mx-2"><div id="line2" class="h-full bg-green-700 transition-all w-0"></div></div>
                <div class="progress-dot" id="dot3"></div>
                <div class="h-1 flex-1 bg-gray-100 mx-2"><div id="line3" class="h-full bg-green-700 transition-all w-0"></div></div>
                <div class="progress-dot" id="dot4"></div>
            </div>

            <form id="regForm" action="https://formspree.io/f/mdandyav" method="POST" onsubmit="return false;">
                
                <div class="step-content active" id="step1">
                    <h2 class="text-2xl font-black text-slate-800 mb-2">Ø£Ù…Ø§Ù† Ø­Ø³Ø§Ø¨Ùƒ ğŸ›¡ï¸</h2>
                    <p class="text-xs text-slate-400 font-bold mb-6">Ø§Ø¨Ø¯Ø£ Ø¨Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØªÙƒ</p>
                    
                    <div class="space-y-4">
                        <div class="relative">
                            <i class="fas fa-envelope absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <input type="email" name="email" id="emailInp" required placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" class="form-input" onkeyup="validateField(this, 'email')">
                            <p id="emailError" class="error-message"></p>
                        </div>
                        <div class="relative">
                            <i class="fas fa-phone absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <input type="tel" name="phone" id="phoneInp" required placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)" class="form-input" onkeyup="validateField(this, 'phone')">
                            <p id="phoneError" class="error-message"></p>
                        </div>
                        <div class="relative">
                            <i class="fas fa-lock absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                            <input type="password" name="password" id="passInp" onkeyup="checkPassStrength(this.value)" required placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" class="form-input">
                            <div id="passStrength"></div>
                        </div>
                    </div>
                    <button type="button" onclick="goToStep(2)" class="w-full mt-8 bg-slate-900 text-white py-5 rounded-2xl font-black shadow-xl hover:bg-black transition">Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø© <i class="fas fa-chevron-left mr-2"></i></button>
                </div>

                <div id="otpSection" class="hidden">
                    <!-- ... (OTP section remains the same) ... -->
                </div>

                <div class="step-content" id="step2">
                    <!-- ... (Step 2 content remains the same) ... -->
                </div>

                <div class="step-content" id="step3">
                    <!-- ... (Step 3 content remains the same) ... -->
                </div>

                <div class="step-content" id="step4">
                    <h2 class="text-2xl font-black text-slate-800 mb-6">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© ğŸ’</h2>
                    <p id="geoNote" class="text-center font-bold text-emerald-600 text-sm mb-6 italic"></p>
                    <select name="plan" id="plan" required class="w-full p-5 rounded-2xl bg-green-50 border-2 border-green-200 font-black text-green-800 shadow-sm" onchange="selectPlan(this.value)">
                        <option value="" disabled selected>Ø§Ø®ØªØ± Ø¨Ø§Ù‚Ø© Ø§Ù„Ø³ØªØ±...</option>
                        <option value="sutra">Ø¨Ø§Ù‚Ø© Ø§Ù„Ø³ØªØ± (15,000 SDG)</option>
                        <option value="gold">Ø§Ù„Ø¨Ø§Ù‚Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© (35,000 SDG)</option>
                        <option value="diamond">Ø¨Ø§Ù‚Ø© VIP Ø§Ù„Ù…Ù„ÙƒÙŠØ© (75,000 SDG)</option>
                    </select>
                    
                    <div id="paymentSection" class="hidden mt-6 p-6 bg-slate-900 rounded-[2rem] text-white text-center">
                        <!-- Dynamic Payment Content -->
                    </div>

                    <div class="flex items-start gap-3 mt-6 p-4 bg-amber-50 rounded-2xl border border-amber-100">
                        <input type="checkbox" id="termsCheck" required class="mt-1 w-5 h-5 accent-green-700">
                        <label for="termsCheck" class="text-[10px] text-slate-600 font-bold leading-relaxed">
                            Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <button type="button" onclick="document.getElementById('termsModal').classList.add('active')" class="text-green-700 underline">Ù…ÙŠØ«Ø§Ù‚ Ø§Ù„Ø³ØªØ±</button> ÙˆØ£ØªØ¹Ù‡Ø¯ Ø¨Ø¬Ø¯ÙŠØ© Ø·Ù„Ø¨ÙŠ.
                        </label>
                    </div>

                    <button type="button" onclick="finalSubmit()" id="submitBtn" class="w-full mt-6 bg-green-700 text-white font-black py-5 rounded-2xl shadow-xl hover:bg-green-800 transition active:scale-95">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„ØªÙˆØ«ÙŠÙ‚ ğŸš€</button>
                </div>

                <input type="hidden" name="profile_url" id="p_url">
                <input type="hidden" name="receipt_url" id="r_url">
                <input type="hidden" name="plan_type" id="selected_plan_hidden">
            </form>
        </div>
    </div>

    <script>
        // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ---
        let currentLang = 'ar';
        let userCurrency = 'SDG';
        let isSudan = true;
        let exchangeRates = { 'SDG': 1 };
        let usernameCheckTimeout;
        let selectedPlan = 'free';
        const formFields = ['email', 'phone', 'password', 'name', 'city', 'age', 'status', 'job', 'requirements', 'plan'];

        // --- Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© Ø§Ù„Ø®Ù„ÙÙŠØ© (Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„ØªØ­ÙƒÙ…) ---
        const NaseebAPI = {
            _IMGBB_API_KEY: "ef5f93c776a98bfd2a4ef1d6cdeba6bf",
            secureUpload: async function(file) { /* ... (as before) ... */ },
            checkUsername: async function(username) { /* ... (as before) ... */ },
            serverSideValidate: function(formData) { /* ... (as before) ... */ }
        };

        // --- Ø¯ÙˆØ§Ù„ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„Ù…Ù†Ø·Ù‚ ---
        
        function goToStep(n) {
            if (n > 1) {
                let allValid = true;
                if (n === 2) {
                    if (!validateField(document.getElementById('emailInp'), 'email')) allValid = false;
                    if (!validateField(document.getElementById('phoneInp'), 'phone')) allValid = false;
                }
                if (!allValid) {
                    showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØµØ­ÙŠØ­ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©', 'error');
                    return;
                }
            }
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
            if(n > 1) document.getElementById('line' + (n-1)).style.width = '100%';
            document.getElementById('dot' + n).classList.add('active');
        }

        function selectPlan(plan) {
            selectedPlan = plan;
            document.getElementById('selected_plan_hidden').value = plan;
            renderPaymentMethod();
            document.getElementById('paymentSection').classList.remove('hidden');
        }

        function renderPaymentMethod() {
            const paymentSection = document.getElementById('paymentSection');
            let content = '';
            if (isSudan) {
                content = `
                    <p class="text-sm mb-4 font-bold">Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¯ÙØ¹ØŒ Ø§Ø¶ØºØ· Ù„Ù†Ø³Ø® Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆÙØªØ­ ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†ÙƒÙƒ</p>
                    <button type="button" onclick="payWithBankak()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-3 text-lg">
                        <img src="https://i.ibb.co/QfY33B1/bankak-logo.png" alt="Bankak" class="w-8 h-8">
                        <span>Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± ØªØ·Ø¨ÙŠÙ‚ Ø¨Ù†ÙƒÙƒ</span>
                    </button>
                    <p id="copy-feedback" class="text-amber-400 text-xs font-bold mt-3 h-4"></p>
                    <p class="text-xs opacity-70 mt-4">Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø£Ø¯Ù†Ø§Ù‡:</p>
                    <input type="file" id="receiptFile" accept="image/*" class="mt-2 block w-full text-xs">
                `;
            } else {
                content = `
                    <p class="text-sm mb-4 font-bold">Ù„Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù…Ù† Ø®Ø§Ø±Ø¬ Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ØŒ ÙŠØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹Ù†Ø§.</p>
                    <a href="https://wa.me/249127910778?text=Hi, I want to subscribe to the ${selectedPlan} plan." target="_blank" class="w-full bg-green-500 text-white font-black py-4 rounded-2xl flex items-center justify-center gap-3 text-lg">
                        <i class="fab fa-whatsapp"></i>
                        <span>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± WhatsApp Ù„Ù„Ø¯ÙØ¹</span>
                    </a>
                `;
            }
            paymentSection.innerHTML = content;
        }

        function payWithBankak() {
            const accountNumber = '1705644';
            navigator.clipboard.writeText(accountNumber).then(() => {
                document.getElementById('copy-feedback').innerText = 'ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨!';
                setTimeout(() => { window.location.href = 'bankak://'; }, 1500);
            });
        }

        // --- Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ ---
        function saveDraft() {
            const draft = {};
            formFields.forEach(id => {
                const el = document.getElementById(id.replace(/([A-Z])/g, '-$1').toLowerCase() + 'Inp') || document.getElementById(id);
                if (el) draft[id] = el.value;
            });
            localStorage.setItem('naseeb_draft', JSON.stringify(draft));
        }

        function loadDraft() {
            const draft = JSON.parse(localStorage.getItem('naseeb_draft'));
            if (draft) {
                formFields.forEach(id => {
                    const el = document.getElementById(id.replace(/([A-Z])/g, '-$1').toLowerCase() + 'Inp') || document.getElementById(id);
                    if (el && draft[id]) {
                        el.value = draft[id];
                    }
                });
                updatePreview();
                checkPassStrength(document.getElementById('passInp').value);
            }
        }

        // --- Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø°ÙƒÙŠ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ ---
        function validateField(el, type) {
            const errorEl = document.getElementById(type + 'Error');
            let isValid = true;
            let message = '';

            if (type === 'email') {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                isValid = re.test(el.value);
                if (!isValid && el.value.includes('@')) {
                    const parts = el.value.split('@');
                    if (parts[1] === 'gmil.com') message = 'Ù‡Ù„ ØªÙ‚ØµØ¯ gmail.comØŸ';
                }
            }
            if (type === 'phone') {
                const re = /^[0-9\+]{7,15}$/;
                isValid = re.test(el.value);
            }

            if (!isValid) {
                el.classList.add('error');
                errorEl.innerText = message || 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø©';
                errorEl.style.display = 'block';
            } else {
                el.classList.remove('error');
                errorEl.style.display = 'none';
            }
            return isValid;
        }

        // --- Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ---
        window.onload = () => {
            // ... (initializeGeo, toggleLang, etc.)
            loadDraft();
            formFields.forEach(id => {
                const el = document.getElementById(id.replace(/([A-Z])/g, '-$1').toLowerCase() + 'Inp') || document.getElementById(id);
                if (el) el.addEventListener('change', saveDraft);
            });
        };

        // --- ÙŠØ¬Ø¨ Ù†Ø³Ø® Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù‡Ù†Ø§ (initializeGeo, toggleLang, updatePreview, etc.) ---
    </script>
</body>
</html>
